<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `eval` mod in crate `oxischeme`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, eval">

    <title>oxischeme::eval - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../main.css">

    
    
</head>
<body class="rustdoc">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <section class="sidebar">
        
        <p class='location'><a href='../index.html'>oxischeme</a></p><div class='block mod'><h2>Modules</h2><a class='mod ' href='../environment/index.html'>environment</a><a class='mod current' href='../eval/index.html'>eval</a><a class='mod ' href='../heap/index.html'>heap</a><a class='mod ' href='../primitives/index.html'>primitives</a><a class='mod ' href='../read/index.html'>read</a><a class='mod ' href='../value/index.html'>value</a></div><div class='block fn'><h2>Functions</h2><a class='fn ' href='../fn.main.html'>main</a><a class='fn ' href='../fn.repl.html'>repl</a></div>
    </section>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press 'S' to search, '?' for more options..."
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content mod">
<h1 class='fqn'><span class='in-band'>Module <a href='../index.html'>oxischeme</a>::<wbr><a class='mod' href=''>eval</a><wbr></span><span class='out-of-band'><span id='render-detail'>
            <a id="collapse-all" href="#">[-]
            </a>&nbsp;<a id="expand-all" href="#">[+]</a>
        </span><a id='src-975' href='../../src/oxischeme/eval.rs.html#15-841'>[src]</a></span></h1>
<div class='docblock'><p>Oxischeme is an interpreter, but it is not a naiive AST walking
interpreter. In contrast to an AST walking interpreter, syntactic analysis
is separated from execution, so that no matter how many times an expression
might be evaluated, it is only ever analyzed once.</p>

<p>When evaluating a form, first we <code>analyze</code> it to derive its semantic
<code>Meaning</code>. The meanings form an intermediate language containing everything
we statically know about the expression, such as whether it is a conditional
or a lambda form, or the location of a value bound to a variable name, so
that we don&#39;t need to compute these things at execution time. After analysis
has produced a meaning for the form, the meaning is then interpreted. This
approach results in a speed up in the realm of 10 - 50 times faster than
simple AST-walking evaluation.</p>

<p>In SICP and LiSP, the implementation language is also Scheme, and the
meanings are just elegant closures. Because we cannot rely on the host
language&#39;s GC like they can, we require more fine-grained control of the data
and its lifetime. Therefore, we explicitly model all data that can be
statically gathered in the <code>MeaningData</code> type. Evaluation of each special
form is implemented by two things: first, a variant in <code>MeaningData</code>, and
secondly a <code>MeaningEvaluatorFn</code> function that takes the heap, an activation,
and the meaning data for that form. The simplest example is quoted forms: we
determine the quoted value during analysis and at runtime simply return it.</p>
<pre id='rust-example-rendered' class='rust '>
<span class='kw'>enum</span> <span class='ident'>MeaningData</span> {
    ...
    <span class='ident'>Quotation</span>(<span class='ident'>RootedValue</span>),
    ...
}

<span class='kw'>fn</span> <span class='ident'>evaluate_quotation</span>(<span class='ident'>heap</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>Heap</span>,
                      <span class='ident'>data</span>: <span class='kw-2'>&amp;</span><span class='ident'>MeaningData</span>,
                      <span class='ident'>act</span>: <span class='kw-2'>&amp;</span><span class='kw-2'>mut</span> <span class='ident'>RootedActivationPtr</span>) <span class='op'>-&gt;</span> <span class='ident'>TrampolineResult</span> {
    <span class='kw'>if</span> <span class='kw'>let</span> <span class='ident'>MeaningData</span>::<span class='ident'>Quotation</span>(<span class='kw-2'>ref</span> <span class='ident'>val</span>) <span class='op'>=</span> <span class='op'>*</span><span class='ident'>data</span> {
        <span class='kw'>return</span> <span class='prelude-val'>Ok</span>(<span class='ident'>Trampoline</span>::<span class='ident'>Value</span>(<span class='ident'>Rooted</span>::<span class='ident'>new</span>(<span class='ident'>heap</span>, <span class='op'>*</span><span class='op'>*</span><span class='ident'>val</span>)));
    }

    <span class='macro'>panic</span><span class='macro'>!</span>(<span class='string'>&quot;unsynchronized MeaningData and MeaningEvaluatorFn&quot;</span>);
}
</pre>

<h2 id="references" class='section-header'><a
                           href="#references">References</a></h2>
<ul>
<li><p><a href="https://mitpress.mit.edu/sicp/full-text/sicp/book/node83.html">&quot;Separating Syntactic Analysis from Execution&quot;</a>,
chapter 4.1.7 of <em>Structure and Interpretation of Computer Programs</em> by
Abelson et all</p></li>
<li><p>&quot;Fast Interpretation&quot;, chapter 6 in <em>Lisp In Small Pieces</em> by Christian
Queinnec</p></li>
</ul>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                    <tr>
                        <td><a class='stability Unmarked' title='No stability level'></a><a class='struct' href='struct.Meaning.html'
                               title='oxischeme::eval::Meaning'>Meaning</a></td>
                        <td class='docblock short'><p>The <code>Meaning</code> type is our intermediate language produced by syntactic
analysis. It is a pair containing a <code>MeaningData</code> variant and its
corresponding <code>MeaningEvaluatorFn</code>.</p>
</td>
                    </tr>
                </table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table>
                    <tr>
                        <td><a class='stability Unmarked' title='No stability level'></a><a class='enum' href='enum.Trampoline.html'
                               title='oxischeme::eval::Trampoline'>Trampoline</a></td>
                        <td class='docblock short'><p>To optimize tail calls and eliminate the stack frames used by them, we
trampoline thunks in a while loop and encode that process in this type.</p>
</td>
                    </tr>
                </table><h2 id='functions' class='section-header'><a href="#functions">Functions</a></h2>
<table>
                    <tr>
                        <td><a class='stability Unmarked' title='No stability level'></a><a class='fn' href='fn.analyze.html'
                               title='oxischeme::eval::analyze'>analyze</a></td>
                        <td class='docblock short'><p>The main entry point for syntactic analysis.</p>
</td>
                    </tr>
                
                    <tr>
                        <td><a class='stability Unmarked' title='No stability level'></a><a class='fn' href='fn.evaluate.html'
                               title='oxischeme::eval::evaluate'>evaluate</a></td>
                        <td class='docblock short'><p>Evaluate the given form in the global environment.</p>
</td>
                    </tr>
                
                    <tr>
                        <td><a class='stability Unmarked' title='No stability level'></a><a class='fn' href='fn.evaluate_file.html'
                               title='oxischeme::eval::evaluate_file'>evaluate_file</a></td>
                        <td class='docblock short'><p>Evaluate the file at the given path and return the value of the last form.</p>
</td>
                    </tr>
                </table><h2 id='types' class='section-header'><a href="#types">Type Definitions</a></h2>
<table>
                    <tr>
                        <td><a class='stability Unmarked' title='No stability level'></a><a class='type' href='type.MeaningResult.html'
                               title='oxischeme::eval::MeaningResult'>MeaningResult</a></td>
                        <td class='docblock short'><p>Either a <code>Meaning</code>, or a <code>String</code> explaining the error.</p>
</td>
                    </tr>
                
                    <tr>
                        <td><a class='stability Unmarked' title='No stability level'></a><a class='type' href='type.TrampolineResult.html'
                               title='oxischeme::eval::TrampolineResult'>TrampolineResult</a></td>
                        <td class='docblock short'><p>Either a <code>Trampoline</code>, or a <code>String</code> describing the error.</p>
</td>
                    </tr>
                </table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <div id="help" class="hidden">
        <div class="shortcuts">
            <h1>Keyboard shortcuts</h1>
            <dl>
                <dt>?</dt>
                <dd>Show this help dialog</dd>
                <dt>S</dt>
                <dd>Focus the search field</dd>
                <dt>&larrb;</dt>
                <dd>Move up in search results</dd>
                <dt>&rarrb;</dt>
                <dd>Move down in search results</dd>
                <dt>&#9166;</dt>
                <dd>Go to active search result</dd>
            </dl>
        </div>
        <div class="infos">
            <h1>Search tricks</h1>
            <p>
                Prefix searches with a type followed by a colon (e.g.
                <code>fn:</code>) to restrict the search to a given type.
            </p>
            <p>
                Accepted types are: <code>fn</code>, <code>mod</code>,
                <code>struct</code>, <code>enum</code>,
                <code>trait</code>, <code>typedef</code> (or
                <code>tdef</code>).
            </p>
        </div>
    </div>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "oxischeme";
        window.playgroundUrl = "";
    </script>
    <script src="../../jquery.js"></script>
    <script src="../../main.js"></script>
    
    <script async src="../../search-index.js"></script>
</body>
</html>